<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        input, button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
    
    <div class="section">
        <h2>1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input type="email" id="reg-email" placeholder="Email" value="test@example.com">
        <input type="password" id="reg-password" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
        <input type="text" id="reg-name" placeholder="–ò–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" value="Test User">
        <button onclick="testRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        <div id="reg-result" class="result"></div>
    </div>

    <div class="section">
        <h2>2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)</h2>
        <input type="email" id="verify-email" placeholder="Email" value="test@example.com">
        <input type="text" id="verify-code" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥">
        <button onclick="testVerifyEmail()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <div id="verify-result" class="result"></div>
    </div>

    <div class="section">
        <h2>3. –í—Ö–æ–¥</h2>
        <input type="email" id="login-email" placeholder="Email" value="test@example.com">
        <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
        <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
        <div id="login-result" class="result"></div>
    </div>

    <div class="section">
        <h2>4. –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
        <input type="email" id="reset-email" placeholder="Email" value="test@example.com">
        <button onclick="testResetPasswordRequest()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥</button>
        <input type="text" id="reset-code" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥">
        <input type="password" id="reset-new-password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" value="newpassword123">
        <button onclick="testResetPassword()">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        <div id="reset-result" class="result"></div>
    </div>

    <script>
        const AUTH_URL = 'https://functions.poehali.dev/f966a25c-d30a-44e4-913d-adfe2d90229d';

        function showResult(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = 'result ' + (isError ? 'error' : 'success');
        }

        function showInfo(elementId, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = 'result info';
        }

        async function testRegister() {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const name = document.getElementById('reg-name').value;

            try {
                const response = await fetch(`${AUTH_URL}?action=register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name: name || null })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    showResult('reg-result', `–û—à–∏–±–∫–∞: ${data.error}`, true);
                    return;
                }

                if (data.email_verification_required) {
                    showInfo('reg-result', `‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n\nüìß –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email.\n${data.verification_code ? `\nüîë –ö–æ–¥: ${data.verification_code}` : '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É.'}`);
                } else {
                    showResult('reg-result', `‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ú–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.`);
                }
            } catch (err) {
                showResult('reg-result', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`, true);
            }
        }

        async function testVerifyEmail() {
            const email = document.getElementById('verify-email').value;
            const code = document.getElementById('verify-code').value;

            try {
                const response = await fetch(`${AUTH_URL}?action=verify-email`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, code })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    showResult('verify-result', `–û—à–∏–±–∫–∞: ${data.error}`, true);
                    return;
                }

                showResult('verify-result', `‚úÖ Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –ú–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.`);
            } catch (err) {
                showResult('verify-result', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`, true);
            }
        }

        async function testLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch(`${AUTH_URL}?action=login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    showResult('login-result', `–û—à–∏–±–∫–∞: ${data.error}`, true);
                    return;
                }

                showResult('login-result', `‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${JSON.stringify(data.user, null, 2)}\n\nAccess token: ${data.access_token.substring(0, 30)}...\nRefresh token: ${data.refresh_token.substring(0, 30)}...`);
            } catch (err) {
                showResult('login-result', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`, true);
            }
        }

        async function testResetPasswordRequest() {
            const email = document.getElementById('reset-email').value;

            try {
                const response = await fetch(`${AUTH_URL}?action=reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    showResult('reset-result', `–û—à–∏–±–∫–∞: ${data.error}`, true);
                    return;
                }

                showInfo('reset-result', `‚úÖ –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–±—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!\n${data.reset_code ? `\nüîë –ö–æ–¥: ${data.reset_code}` : '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–æ—á—Ç—É.'}`);
            } catch (err) {
                showResult('reset-result', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`, true);
            }
        }

        async function testResetPassword() {
            const email = document.getElementById('reset-email').value;
            const code = document.getElementById('reset-code').value;
            const newPassword = document.getElementById('reset-new-password').value;

            try {
                const response = await fetch(`${AUTH_URL}?action=reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, code, new_password: newPassword })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    showResult('reset-result', `–û—à–∏–±–∫–∞: ${data.error}`, true);
                    return;
                }

                showResult('reset-result', `‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω! –ú–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º.`);
            } catch (err) {
                showResult('reset-result', `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`, true);
            }
        }
    </script>
</body>
</html>
